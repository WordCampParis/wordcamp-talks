/*! wordcamp-talks - v1.3.1 - 2020-01-20 1:48:42 PM UTC - https://github.com/WordCampParis/wordcamp-talks */

!function(n,i){if("undefined"!=typeof wctJSvars&&wctJSvars.users){var s={Models:{},Collections:{},Views:{},View:n.Backbone.View.extend({prepare:function(){return!_.isUndefined(this.model)&&_.isFunction(this.model.toJSON)?this.model.toJSON():{}}})};s.Models.LogEmail=Backbone.Model.extend({defaults:{type:"",log_message:"",user_email:""}}),s.Collections.LogEmails=Backbone.Collection.extend({model:s.Models.LogEmail}),s.Models.Applicant=Backbone.Model.extend({defaults:{id:0,display_name:"",user_email:""}}),s.Collections.Applicants=Backbone.Collection.extend({model:s.Models.Applicant,send:function(e,t){var i=e.attributes||{},s=_.first(this.models),a=this;if(!s.get("id"))return!1;n.ajax.post("wct_email_applicant",_.extend(i,s.attributes)).always(function(e){a.remove(s),t.add(e),a.length||t.add({type:"info",log_message:wctJSvars.strings.endedBulk})})}}),s.Views.feedbackEntry=s.View.extend({tagName:"li",template:n.template("wct-log-entries")}),s.Views.feedBacks=s.View.extend({tagName:"ul",initialize:function(){this.collection.on("add",this.addLogEntry,this)},addLogEntry:function(e){this.views.add(new s.Views.feedbackEntry({model:e}))}}),s.Views.applicantEntry=s.View.extend({tagName:"li",template:n.template("wct-applicants-list"),initialize:function(){this.model.on("remove",this.removeView,this)},removeView:function(){this.views.view.remove()}}),s.Views.ApplicantList=s.View.extend({tagName:"ul",initialize:function(){var t=[];this.collection.on("reset",this.addListEntry,this),_.each(wctJSvars.users,function(e){t.push(new s.Models.Applicant({id:e.ID,display_name:e.display_name,user_email:e.user_email}))}),this.collection.reset(t)},addListEntry:function(e){_.each(e.models,function(e){this.views.add(new s.Views.applicantEntry({model:e}))},this)}}),s.Views.label=s.View.extend({tagName:"label",render:function(){return this.$el.html(this.options.content),this}}),s.Views.Input=s.View.extend({tagName:"input",events:{blur:"setEmailAttribute"},initialize:function(){this.options.email.on("change:sending",this.updateInputState,this)},setEmailAttribute:function(e){this.options.email.set(this.attributes.name,i(e.currentTarget).val())},updateInputState:function(e,t){t?i(this.el).prop("readonly",!0):(i(this.el).prop("readonly",!1),e.get(this.attributes.name)||i(this.el).val(""))}}),s.Views.bodyMessage=s.Views.Input.extend({tagName:"textarea",events:{keyup:"setEmailAttribute"}}),s.Views.submitMessage=s.View.extend({tagName:"button",attributes:{class:"button button-primary",disabled:!0},events:{click:"sendEmails"},initialize:function(){this.options.email.on("change:content",this.updateButtonState,this),this.options.email.on("change:sending",this.updateButtonState,this),this.collection.on("remove",this.nextEmail,this)},render:function(){return this.$el.html(this.options.content),this},updateButtonState:function(e,t){t&&!0!==e.get("sending")?i(this.el).prop("disabled",!1):i(this.el).prop("disabled",!0)},sendEmails:function(){this.options.email.set("sending",!0),this.options.logs.add({type:"info",log_message:wctJSvars.strings.startedBulk}),this.collection.send(this.options.email,this.options.logs)},nextEmail:function(){this.collection.length?this.collection.send(this.options.email,this.options.logs):this.options.email.clear()}}),s.Views.Main=s.View.extend({initialize:function(){var e=new s.Collections.Applicants,t=new Backbone.Model,i=new s.Collections.LogEmails;this.views.add("#wordcamp-talks-mailer",new s.Views.ApplicantList({collection:e})),this.views.add("#wordcamp-talks-mailer",new s.Views.label({attributes:{for:"email-subject",class:"label"},content:wctJSvars.strings.emailSubject})),this.views.add("#wordcamp-talks-mailer",new s.Views.Input({collection:e,attributes:{id:"email-subject",type:"text",class:"widefat code",name:"subject"},email:t})),this.views.add("#wordcamp-talks-mailer",new s.Views.label({attributes:{for:"email-body-reply-to",class:"label"},content:wctJSvars.strings.emailReplyTo})),this.views.add("#wordcamp-talks-mailer",new s.Views.Input({collection:e,attributes:{id:"email-body-reply-to",type:"text",class:"widefat code",name:"reply_to"},email:t})),this.views.add("#wordcamp-talks-mailer",new s.Views.label({attributes:{for:"email-body-message",class:"label"},content:wctJSvars.strings.emailMessage})),this.views.add("#wordcamp-talks-mailer",new s.Views.bodyMessage({collection:e,attributes:{id:"email-body-message",cols:50,rows:10,class:"widefat code",name:"content"},email:t})),this.views.add("#wordcamp-talks-mailer",new s.Views.submitMessage({collection:e,content:wctJSvars.strings.emailSubmit,email:t,logs:i})),this.views.add("#wordcamp-talks-mailer-log-entries",new s.Views.feedBacks({collection:i}))}}),new s.Views.Main({el:"#wordcamp-talks-mailer-wrapper"}).render()}}(window.wp||{},jQuery);