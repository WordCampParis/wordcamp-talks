/*! wordcamp-talks - v1.3.0 - 2019-03-16 9:47:57 AM UTC - https://github.com/WordCampParis/wordcamp-talks */
!function(a,b){if("undefined"!=typeof wctJSvars&&wctJSvars.users){var c={Models:{},Collections:{},Views:{},View:a.Backbone.View.extend({prepare:function(){return!_.isUndefined(this.model)&&_.isFunction(this.model.toJSON)?this.model.toJSON():{}}})};c.Models.LogEmail=Backbone.Model.extend({defaults:{type:"",log_message:"",user_email:""}}),c.Collections.LogEmails=Backbone.Collection.extend({model:c.Models.LogEmail}),c.Models.Applicant=Backbone.Model.extend({defaults:{id:0,display_name:"",user_email:""}}),c.Collections.Applicants=Backbone.Collection.extend({model:c.Models.Applicant,send:function(b,c){var d=b.attributes||{},e=_.first(this.models),f=this;return!!e.get("id")&&void a.ajax.post("wct_email_applicant",_.extend(d,e.attributes)).always(function(a){f.remove(e),c.add(a),f.length||c.add({type:"info",log_message:wctJSvars.strings.endedBulk})})}}),c.Views.feedbackEntry=c.View.extend({tagName:"li",template:a.template("wct-log-entries")}),c.Views.feedBacks=c.View.extend({tagName:"ul",initialize:function(){this.collection.on("add",this.addLogEntry,this)},addLogEntry:function(a){this.views.add(new c.Views.feedbackEntry({model:a}))}}),c.Views.applicantEntry=c.View.extend({tagName:"li",template:a.template("wct-applicants-list"),initialize:function(){this.model.on("remove",this.removeView,this)},removeView:function(){this.views.view.remove()}}),c.Views.ApplicantList=c.View.extend({tagName:"ul",initialize:function(){var a=[];this.collection.on("reset",this.addListEntry,this),_.each(wctJSvars.users,function(b){a.push(new c.Models.Applicant({id:b.ID,display_name:b.display_name,user_email:b.user_email}))}),this.collection.reset(a)},addListEntry:function(a){_.each(a.models,function(a){this.views.add(new c.Views.applicantEntry({model:a}))},this)}}),c.Views.label=c.View.extend({tagName:"label",render:function(){return this.$el.html(this.options.content),this}}),c.Views.Input=c.View.extend({tagName:"input",events:{blur:"setEmailAttribute"},initialize:function(){this.options.email.on("change:sending",this.updateInputState,this)},setEmailAttribute:function(a){this.options.email.set(this.attributes.name,b(a.currentTarget).val())},updateInputState:function(a,c){c?b(this.el).prop("readonly",!0):(b(this.el).prop("readonly",!1),a.get(this.attributes.name)||b(this.el).val(""))}}),c.Views.bodyMessage=c.Views.Input.extend({tagName:"textarea",events:{keyup:"setEmailAttribute"}}),c.Views.submitMessage=c.View.extend({tagName:"button",attributes:{class:"button button-primary",disabled:!0},events:{click:"sendEmails"},initialize:function(){this.options.email.on("change:content",this.updateButtonState,this),this.options.email.on("change:sending",this.updateButtonState,this),this.collection.on("remove",this.nextEmail,this)},render:function(){return this.$el.html(this.options.content),this},updateButtonState:function(a,c){c&&!0!==a.get("sending")?b(this.el).prop("disabled",!1):b(this.el).prop("disabled",!0)},sendEmails:function(){this.options.email.set("sending",!0),this.options.logs.add({type:"info",log_message:wctJSvars.strings.startedBulk}),this.collection.send(this.options.email,this.options.logs)},nextEmail:function(){this.collection.length?this.collection.send(this.options.email,this.options.logs):this.options.email.clear()}}),c.Views.Main=c.View.extend({initialize:function(){var a=new c.Collections.Applicants,b=new Backbone.Model,d=new c.Collections.LogEmails;this.views.add("#wordcamp-talks-mailer",new c.Views.ApplicantList({collection:a})),this.views.add("#wordcamp-talks-mailer",new c.Views.label({attributes:{for:"email-subject",class:"label"},content:wctJSvars.strings.emailSubject})),this.views.add("#wordcamp-talks-mailer",new c.Views.Input({collection:a,attributes:{id:"email-subject",type:"text",class:"widefat code",name:"subject"},email:b})),this.views.add("#wordcamp-talks-mailer",new c.Views.label({attributes:{for:"email-body-reply-to",class:"label"},content:wctJSvars.strings.emailReplyTo})),this.views.add("#wordcamp-talks-mailer",new c.Views.Input({collection:a,attributes:{id:"email-body-reply-to",type:"text",class:"widefat code",name:"reply_to"},email:b})),this.views.add("#wordcamp-talks-mailer",new c.Views.label({attributes:{for:"email-body-message",class:"label"},content:wctJSvars.strings.emailMessage})),this.views.add("#wordcamp-talks-mailer",new c.Views.bodyMessage({collection:a,attributes:{id:"email-body-message",cols:50,rows:10,class:"widefat code",name:"content"},email:b})),this.views.add("#wordcamp-talks-mailer",new c.Views.submitMessage({collection:a,content:wctJSvars.strings.emailSubmit,email:b,logs:d})),this.views.add("#wordcamp-talks-mailer-log-entries",new c.Views.feedBacks({collection:d}))}}),new c.Views.Main({el:"#wordcamp-talks-mailer-wrapper"}).render()}}(window.wp||{},jQuery);